---

repo_url: http://10.168.0.45:8089/repository/raw-public/monitoring/prometheus
prometheus_install_dir: /usr/its/monitoring/prometheus
grafana_home: /usr/its/monitoring/grafana

netdata_config:
  global:
    history: 7200
  "plugin:apps":
    update every: 1
  "plugin:proc":
    /proc/net/snmp: "no"
    /proc/net/snmp6: "no"
# Configure alert manager
prometheus_alertmanager_config:
- scheme: http
  static_configs:
    - targets: 
      - "{{ ansible_host }}:9093"
# Configure prometheus targets
prometheus_targets:
  node:
    - targets: "{{ groups['all'] | map('extract', hostvars, ['ansible_host']) | map('regex_replace', '$', ':9100') | list }}"
      labels:
        env: demo
  alertmanager:
    - targets:
      - "{{ ansible_host }}:9093"
      labels:
        env: demo
  grafana:
    - targets:
      - "{{ ansible_host }}:3000"
      labels:
        env: demo
  netdata:
    - targets:
      - "{{ ansible_host }}:19999"
      labels:
        env: demo

# Prometheus scrap config
prometheus_scrape_configs:
- job_name: "prometheus"
  metrics_path: "/metrics"
  static_configs:
  - targets:
    - "{{ ansible_host }}:9090"
- job_name: "node"
  file_sd_configs:
  - files:
    - "/etc/prometheus/file_sd/node.yml"
- job_name: "alertmanager"
  file_sd_configs:
  - files:
    - "/etc/prometheus/file_sd/alertmanager.yml"
- job_name: "grafana"
  file_sd_configs:
  - files:
    - "/etc/prometheus/file_sd/grafana.yml"
- job_name: "netdata"
  scrape_interval: 60s
  metrics_path: "/api/v1/allmetrics"
  params:
    format: ['prometheus']
  honor_labels: true
  file_sd_configs:
  - files:
    - "/etc/prometheus/file_sd/netdata.yml"
- job_name: "pushgateway"
  metrics_path: "/metrics"
  static_configs:
  - targets:
    - "{{ ansible_host }}:9091"

# Configure slack
alertmanager_external_url: "http://{{ ansible_host }}:9093"
alertmanager_slack_api_url: "https://hooks.slack.com/services/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"
alertmanager_receivers:
- name: slack
  slack_configs:
  - send_resolved: true
    api_url: $slack_api_url
    channel: '#alerts'
alertmanager_route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: slack

# Grafana authentication         
grafana_auth:
  anonymous:
    org_name: "Main Org."
    org_role: Viewer

grafana_security:
  admin_user: admin
  admin_password: "admin"

# Grafana datasources
grafana_datasources:
- name: "Prometheus"
  type: "prometheus"
  access: "proxy"
  url: "http://{{ ansible_host }}:9090"
  isDefault: true

- name: Ambari Metrics
  type: Ambari Metrics
  access: proxy
  #url: "http://{{ ansible_host }}:9090"

# Grafana plugins
grafana_plugins:
- "prajwalrao-ambari-metrics-grafana-1.0.1-1-gd429f53"

# Grafana dashboards
grafana_dashboards:
# Node Exporter Full with Hostname
- category: exporters
  name: 'node-exporter-full'
  dashboard_id: '1860'
  revision_id: '12'
  datasource: '{{ grafana_datasources.0.name }}'
# Prometheus 2.0 Overview
- category: exporters
  name: 'prometheus-2-0-overview'
  dashboard_id: '3662'
  revision_id: '2'
  datasource: '{{ grafana_datasources.0.name }}'
# Netdata: Netdata dashboards for Grafana via Prometheus.
- category: exporters
  name: 'netdata'
  dashboard_id: '7107'
  revision_id: '1'
  datasource: '{{ grafana_datasources.0.name }}'
# Ambari metrics dashboards
- category: ams
  name: all

